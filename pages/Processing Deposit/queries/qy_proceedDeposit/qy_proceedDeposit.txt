-- 1. Masukkan data yang cocok ke table transactions_success dan set status = 'Success'
INSERT INTO transactions_success (username, transactioncode, transactiondate, amount, status)
SELECT t.username, t.transactioncode, t.transactiondate, s.saldo, 'Success'
FROM transactions t
JOIN savedatabaru s
  ON t.transactioncode = s.transactioncode AND t.transactiondate = s.date;

-- 2. Masukkan data yang tidak cocok ke table transactions_invalid dan set status = 'Invalid'
INSERT INTO transactions_invalid (username, transactioncode, transactiondate, amount, status)
SELECT t.username, t.transactioncode, t.transactiondate, t.amount, 'Invalid'
FROM transactions t
WHERE NOT EXISTS (
	SELECT 1
	FROM savedatabaru s
	WHERE s.transactioncode = t.transactioncode
	AND s.date = t.transactiondate
);

-- 3. Hapus data yang cocok dari savedatabaru
DELETE FROM savedatabaru
WHERE EXISTS (
	SELECT 1
	FROM transactions t
	WHERE t.transactioncode = savedatabaru.transactioncode
	AND t.transactiondate = savedatabaru.date
);

-- 4. Hapus data yang cocok dari transactions
DELETE FROM transactions
WHERE EXISTS (
	SELECT 1
	FROM savedatabaru s
	WHERE s.transactioncode = transactions.transactioncode
	AND s.date = transactions.transactiondate
);

-- 5. Hapus data yang tidak cocok dari transactions
DELETE FROM transactions
WHERE NOT EXISTS (
	SELECT 1
	FROM savedatabaru s
	WHERE s.transactioncode = transactions.transactioncode
	AND s.date = transactions.transactiondate
);
